#!/usr/bin/env bash

set -Ceuo pipefail

readonly VIM_REPO_PATH="$(ghq list -p | grep -m 1 'vim/vim')"
readonly CONFIG_CACHE='src/auto/config.cache'

cd "${VIM_REPO_PATH}"

if [[ -f "${CONFIG_CACHE}" ]]; then
  sudo make uninstall
  rm src/auto/config.cache
  git fetch -v
  git switch -d origin/master
fi

./configure \
  --disable-gui \
  --enable-fail-if-missing \
  --enable-luainterp=dynamic \
  --enable-perlinterp=dynamic \
  --enable-python3interp=dynamic \
  --enable-rubyinterp=dynamic \
  --enable-tclinterp=dynamic \
  ;

make -j"$(nproc)"
sudo make install

echo
vim --version | head -n 2
