#!/usr/bin/env bash

set -Ceuo pipefail

readonly GHQ_ROOT="$(ghq root)"
readonly VIM_REPO="$(ghq list | grep vim/vim)"
readonly VIM_REPO_PATH="${GHQ_ROOT}/${VIM_REPO}"
readonly CONFIG_CACHE='src/auto/config.cache'

cd "${VIM_REPO_PATH}"

if [[ -f "${CONFIG_CACHE}" ]]; then
  sudo make uninstall
  rm src/auto/config.cache
  git pull
fi

./configure \
  --enable-fail-if-missing \
  --enable-python3interp=dynamic \
  --enable-perlinterp=dynamic \
  --enable-rubyinterp=dynamic \
  --enable-luainterp=dynamic \
  --enable-tclinterp=dynamic \
  --disable-gui

make -j8
sudo make install

echo
vim --version | head -n 2
